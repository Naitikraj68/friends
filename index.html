<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Dosti Never Loses</title>
    <style>
      /* ---------- ORIGINAL STYLES ---------- */
      body {
        background: #000;
        font-family: 'Courier New', monospace;
        color: #0ff;
        margin: 0;
        padding: 0;
        position: relative;
        overflow-x: hidden;
      }

      /* ---------- CANVAS STYLES FOR MAIN CONTENT ---------- */
      #starCanvasMain,
      #fireflyCanvasMain {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1; /* Piche rehne ke liye */
      }

      #intro {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        animation: hideIntro 1s ease-in-out 4s forwards;
      }
      #intro img {
        width: 100%;
        max-width: 768px; /* Max width for larger screens */
        height: auto;     /* Maintain aspect ratio */
        max-height: 90vh; /* Ensure it fits viewport height */
        animation: zoomInOut 4s ease-in-out forwards;
        border-radius: 15px;
        box-shadow: 0 0 20px cyan;
      }
      @keyframes zoomInOut {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }
      @keyframes hideIntro {
        to {
          opacity: 0;
          visibility: hidden;
        }
      }

      .rotating-sphere {
        margin: 20px auto;
        width: 150px;
        height: 150px;
        position: relative;
        transform-style: preserve-3d;
        animation: spin 6s linear infinite;
        perspective: 1000px;
      }
      .face {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: radial-gradient(circle at center, #000 30%, #0ff 100%);
        color: red;
        font-size: 22px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        text-shadow: 0 0 10px red;
      }
      .front {
        transform: rotateY(0) translateZ(75px);
      }
      .back {
        transform: rotateY(180deg) translateZ(75px);
      }
      @keyframes spin {
        from {
          transform: rotateY(0);
        }
        to {
          transform: rotateY(360deg);
        }
      }

      #main-content {
        padding: 40px 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh; /* Ensure it takes at least full viewport height */
        box-sizing: border-box; /* Include padding in height calculation */
      }
      .form-box {
        background: rgba(0, 0, 0, 0.75);
        border: 2px solid #0ff;
        box-shadow: 0 0 15px #0ff, 0 0 40px #0ff;
        border-radius: 15px;
        padding: 30px;
        max-width: 400px;
        width: 100%;
        backdrop-filter: blur(5px);
        margin-bottom: 20px; /* Added margin for spacing */
      }
      .form-header {
        font-size: 1rem;
        margin: 10px 0 5px;
      }
      input[type="text"], input[type="email"], input[type="password"] { /* Specificity for inputs */
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: none;
        margin-bottom: 10px;
        font-size: 1rem;
        background: #e6f0ff;
        box-shadow: 0 0 5px #0ff;
        box-sizing: border-box;
        color: #333; /* Ensure text is visible */
      }
      .submit-btn, .video-btn, .shayari-btn { /* Shared button styles */
        width: 100%;
        padding: 10px;
        margin-top: 15px;
        font-size: 1rem;
        border: none;
        border-radius: 10px;
        background: linear-gradient(45deg, #00f, #f0f);
        color: #fff;
        cursor: pointer;
        box-shadow: 0 0 10px #00f, 0 0 20px #f0f;
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .submit-btn:hover, .video-btn:hover, .shayari-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 15px #00f, 0 0 30px #f0f;
      }

      .msg {
        margin-top: 15px;
        font-size: 0.95rem;
        text-align: center;
        white-space: pre-line;
        text-shadow: 0 0 10px #0ff;
      }
      .video-btn {
        margin-top: 10px; /* Keep original margin */
        box-shadow: 0 0 8px #0ff; /* Keep original shadow */
      }
      .watch-heading {
        margin-top: 25px;
        font-size: 1.2rem;
        text-align: center;
        text-shadow: 0 0 10px #0ff;
      }
      a {
        text-decoration: none;
      }

      /* ---------- AI SHAYARI GENERATOR STYLES ---------- */
      .shayari-generator {
        background: rgba(0, 255, 255, 0.1); /* Cyan tint */
        border: 2px solid #0ff;
        box-shadow: 0 0 15px #0ff, 0 0 30px #0ff;
        border-radius: 15px;
        padding: 20px;
        max-width: 400px;
        width: 100%;
        backdrop-filter: blur(8px);
        margin-top: 30px;
        text-align: center;
      }
      .shayari-generator h2 {
        font-size: 1.3rem;
        margin-bottom: 15px;
        text-shadow: 0 0 10px #0ff;
      }
      #shayariKeywordInput {
        width: calc(100% - 22px); /* Account for padding */
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #0ff;
        margin-bottom: 15px;
        font-size: 1rem;
        background: rgba(0,0,0,0.5);
        color: #0ff;
        box-shadow: 0 0 5px #0ff inset;
      }
      #shayariKeywordInput::placeholder {
        color: rgba(0, 255, 255, 0.7);
      }
      #generatedShayari {
        margin-top: 20px;
        font-size: 1.1rem;
        min-height: 60px; /* Space for 2-3 lines */
        white-space: pre-line;
        text-shadow: 0 0 8px #0ff;
        border: 1px dashed #0ff;
        padding: 10px;
        border-radius: 8px;
        background: rgba(0,0,0,0.3);
        color: #fff; /* Brighter color for generated text */
      }
       #shayariLoading {
        font-size: 0.9rem;
        color: #f0f; /* Magenta for loading text */
        margin-top: 10px;
      }


      /* ---------- SETTINGS BUTTON + PANEL ---------- */
      #settingsBtn {
        position: fixed;
        top: 15px;
        left: 15px;
        z-index: 999;
        background: #000;
        color: #0ff;
        border: 2px solid #0ff;
        padding: 10px 15px;
        font-size: 16px;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 0 10px #0ff;
      }
      #settingsPanel {
        position: fixed;
        top: 0;
        right: -100%; /* Start off-screen */
        width: 100%;
        max-width: 400px; /* Max width for panel */
        height: 100%;
        background: #000;
        color: #0ff;
        overflow-y: auto;
        z-index: 10000;
        box-shadow: -5px 0 20px #0ff;
        padding: 20px;
        transition: right 0.5s ease;
        font-family: 'Courier New', monospace;
        box-sizing: border-box;
      }
      #settingsPanel.active {
        right: 0;
      }
      /* Ensure inputs within settings panel also use box-sizing */
      #settingsPanel input[type="text"], 
      #settingsPanel input[type="password"] {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        font-size: 1rem;
        background: #e6f0ff;
        border-radius: 8px;
        border: none;
        box-sizing: border-box;
        color: #333; /* Ensure text is visible */
      }
      #settingsPanel button { /* General button style for settings */
        width: 100%;
        padding: 10px;
        font-size: 1rem;
        background: linear-gradient(45deg, #00f, #f0f);
        color: #fff;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        margin-top: 5px;
        box-shadow: 0 0 10px #00f, 0 0 20px #f0f;
        box-sizing: border-box;
      }
      .profile {
        margin-bottom: 30px;
      }
      .profile h3 {
        margin-bottom: 10px;
      }
      .photos {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        flex-wrap: wrap; /* Allow images to wrap on smaller screens */
      }
      .photos img {
        width: clamp(80px, 25vw, 100px); /* Responsive image size */
        height: clamp(80px, 25vw, 100px);
        object-fit: cover;
        border-radius: 10px;
        box-shadow: 0 0 10px #0ff;
        cursor: pointer;
        transition: transform 0.3s;
      }
      .photos img:hover {
        transform: scale(1.08);
      }
      .shayari {
        font-size: 1rem;
        text-shadow: 0 0 10px #0ff;
      }
      .typewriter {
        display: inline-block;
        overflow: hidden;
        white-space: nowrap;
        border-right: 2px solid #0ff;
        /* Animation will be applied via JS */
      }
      @keyframes typing {
        from {
          width: 0;
        }
        to {
          width: 100%;
        }
      }
      @keyframes blink-caret {
        50% {
          border-color: transparent;
        }
      }
      .section-title {
        font-size: 1.3rem;
        margin: 20px 0 10px;
        text-shadow: 0 0 10px #0ff;
      }
      .about-text {
        font-size: 1rem;
        margin-bottom: 20px;
        white-space: pre-line;
        text-shadow: 0 0 8px #0ff;
      }
      .contact-section {
        margin-top: 20px;
        text-align: center;
        font-size: 1rem;
        text-shadow: 0 0 10px #0ff;
      }
      #closeSettings {
        position: absolute;
        top: 10px;
        right: 15px;
        background: transparent;
        color: #0ff;
        font-size: 24px;
        border: none;
        cursor: pointer;
      }

      /* ---------- FULLSCREEN IMAGE MODAL ---------- */
      #imageModal {
        display: none;
        position: fixed;
        z-index: 15000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }
      #imageModal img {
        max-width: 90vw;
        max-height: 80vh;
        border-radius: 10px;
        box-shadow: 0 0 25px #0ff;
      }
      #imageModal .caption {
        margin: 15px auto;
        text-align: center;
        color: #0ff;
        font-size: 1.1rem;
        text-shadow: 0 0 10px #0ff;
        max-width: 90%;
      }
      #imageModal .closeBtn,
      #imageModal .prev,
      #imageModal .next {
        position: absolute;
        color: #0ff;
        font-size: clamp(30px, 5vw, 40px); /* Responsive font size */
        font-weight: bold;
        user-select: none;
        cursor: pointer;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        padding: 5px 12px;
        transition: 0.3s;
      }
      #imageModal .closeBtn {
        top: 20px;
        right: 20px; /* Adjusted for smaller screens */
      }
      #imageModal .prev {
        top: 50%;
        left: 10px; /* Adjusted for smaller screens */
        transform: translateY(-50%);
      }
      #imageModal .next {
        top: 50%;
        right: 10px; /* Adjusted for smaller screens */
        transform: translateY(-50%);
      }
      #imageModal .prev:hover,
      #imageModal .next:hover,
      #imageModal .closeBtn:hover {
        color: #f00;
        background: rgba(0, 0, 0, 0.8);
      }

      /* ---------- NEW FEATURES STYLES ---------- */
      .profile { /* Glassmorphism already applied */
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 15px;
        border-radius: 12px;
      }
      #starCanvas,
      #fireflyCanvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -2; /* settingsPanel ke piche */
      }
      .heart {
        position: absolute;
        font-size: 16px;
        color: pink;
        pointer-events: none;
        animation: floatUp 2s ease-out forwards;
        z-index: 10001; /* Ensure hearts are above settings panel content but below modal */
      }
      @keyframes floatUp {
        to {
          transform: translateY(-50px);
          opacity: 0;
        }
      }
      .parallax {
        position: relative;
        will-change: transform;
      }
      #signatureSVG text {
        fill: none;
        stroke: #0ff;
        stroke-width: 2;
        stroke-dasharray: 1000; /* Will be set by JS */
        stroke-dashoffset: 1000; /* Will be set by JS */
        font-family: 'Pacifico', cursive;
        font-size: 2rem;
        /* Animation will be applied via JS */
      }
      @keyframes draw {
        to {
          stroke-dashoffset: 0;
        }
      }

      /* Music Button Style from user */
      .music-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #222;
        color: white;
        border: 2px solid #0ff; /* Added border to match theme */
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        z-index: 1000;
        box-shadow: 0 0 8px #0ff; /* Added shadow */
      }
      .music-btn:hover {
        background-color: #333;
        box-shadow: 0 0 12px #0ff;
      }
    </style>

    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div id="intro">
      <img 
        src="intro.png" 
        alt="Intro Image - Dosti Never Loses" 
        onerror="this.onerror=null; this.src='https://placehold.co/768x768/000000/00FFFF?text=Dosti+Never+Loses'; this.alt='Fallback Intro Image';" 
      />
    </div>

    <canvas id="starCanvasMain"></canvas>
    <canvas id="fireflyCanvasMain"></canvas>

    <div id="main-content" style="display:none;"> <div class="rotating-sphere">
        <div class="face front">ANS</div>
        <div class="face back">NaitikSingh</div>
      </div>
      <div class="form-box">
        <h3 class="form-header">Full Name</h3>
        <input type="text" id="nameInput" placeholder="Enter your name" />
        <h3 class="form-header">Mobile Number</h3>
        <input type="text" id="mobileInput" placeholder="Enter your number" />
        <h3 class="form-header">Email</h3>
        <input type="email" id="emailInput" placeholder="Enter your email" />
        <button class="submit-btn" onclick="handleSubmit()">🚀 Submit</button>
        <div class="msg" id="messageBox" style="display: none"></div>
        <div id="videoSection" style="display: none">
          <h2 class="watch-heading">🎵 Watch Videos:</h2>
          <a
            href="https://youtu.be/f72iVBTuSbw?si=yrpkT7uudpRakq7T"
            target="_blank"
            rel="noopener noreferrer"
          >
            <button class="video-btn">😂 AdiNaiSat</button>
          </a>
          <a
            href="https://youtu.be/IgM1lAXppwI?si=TywO3SPv1tPph8KW"
            target="_blank"
            rel="noopener noreferrer"
          >
            <button class="video-btn">🎶 YouTube 🥺</button>
          </a>
          <a
            href="https://youtu.be/BTRPBiE_1lA?si=CIZYJGp-V0m0cauU"
            target="_blank"
            rel="noopener noreferrer"
          >
            <button class="video-btn">🎤 Friends Forever☺️</button>
          </a>
        </div>
      </div>

      <div class="shayari-generator">
        <h2>✨ AI Friendship Shayari ✨</h2>
        <p style="font-size:0.9rem; margin-bottom:15px;">Enter a name or word for a unique shayari!</p>
        <input type="text" id="shayariKeywordInput" placeholder="E.g., Naitik, Dosti, Yaar..." />
        <button class="shayari-btn" onclick="generateShayari()">💖 Generate Shayari</button>
        <div id="shayariLoading" style="display: none;">Generating... please wait...</div>
        <div id="generatedShayari">Aapki AI-generated shayari yahaan dikhegi...</div>
      </div>
      </div>

    <button id="settingsBtn">⚙️</button>
    <div id="settingsPanel">
      <canvas id="starCanvas"></canvas>
      <canvas id="fireflyCanvas"></canvas>
      <button id="closeSettings" onclick="closeSettingsPanel()">Close ⚙️</button> <div id="passwordPrompt">
        <h3>Enter Password</h3>
        <input type="password" id="pwdInput" placeholder="Enter password" />
        <button onclick="verifyPassword()">Unlock</button>
        <p
          id="pwdError"
          class="msg"
          style="color: red; display: none"
        >
          Incorrect password!
        </p>
      </div>

      <div id="settingsContent" style="display: none">
        <h2 class="section-title">Profiles</h2>
        <div class="profile parallax">
          <h3>NAITIK</h3>
          <div class="photos">
            <img src="naitik1.jpg" alt="Naitik - Rajput" onerror="this.onerror=null; this.src='https://placehold.co/100x100/0000FF/FFFFFF?text=Naitik+1'; this.alt='Fallback Naitik 1';" />
            <img src="naitik2.jpg" alt="Naitik" onerror="this.onerror=null; this.src='https://placehold.co/100x100/00FFFF/000000?text=Naitik+2'; this.alt='Fallback Naitik 2';"/>
            <img src="naitik3.jpg" alt="Naitik - Singh" onerror="this.onerror=null; this.src='https://placehold.co/100x100/FF00FF/FFFFFF?text=Naitik+3'; this.alt='Fallback Naitik 3';" />
          </div>
          <p class="shayari">
            <span class="typewriter">
              Main hoon dosti ka sabse pyara chehra, <br />
              Dil se juda, har waqt ka sahara.🧐🧐
            </span>
          </p>
        </div>
        <div class="profile parallax">
          <h3>SATYAM</h3>
          <div class="photos">
            <img src="satyam1.jpg" alt="Satyam 1" onerror="this.onerror=null; this.src='https://placehold.co/100x100/FFFF00/000000?text=Satyam+1'; this.alt='Fallback Satyam 1';" />
            <img src="satyam2.jpg" alt="Satyam 2" onerror="this.onerror=null; this.src='https://placehold.co/100x100/00FF00/FFFFFF?text=Satyam+2'; this.alt='Fallback Satyam 2';" />
            <img src="satyam3.jpg" alt="Satyam 3" onerror="this.onerror=null; this.src='https://placehold.co/100x100/FF0000/FFFFFF?text=Satyam+3'; this.alt='Fallback Satyam 3';" />
          </div>
          <p class="shayari">
            <span class="typewriter">
              Sachhai mein basa naam hai tera,<br />
              Dosti ki rooh hai tu mera sachcha sahara.🥰🥰
            </span>
          </p>
        </div>
        <div class="profile parallax">
          <h3>ADITYA</h3>
          <div class="photos">
            <img src="aditya1.jpg" alt="Aditya 1" onerror="this.onerror=null; this.src='https://placehold.co/100x100/800080/FFFFFF?text=Aditya+1'; this.alt='Fallback Aditya 1';" />
            <img src="aditya2.jpg" alt="Aditya 2" onerror="this.onerror=null; this.src='https://placehold.co/100x100/008080/FFFFFF?text=Aditya+2'; this.alt='Fallback Aditya 2';" />
            <img src="aditya3.jpg" alt="Aditya 3" onerror="this.onerror=null; this.src='https://placehold.co/100x100/FFA500/000000?text=Aditya+3'; this.alt='Fallback Aditya 3';" />
          </div>
          <p class="shayari">
            <span class="typewriter">
              Teri hansi mein jaadu hai kuch aisa,<br />
              Jo gamon ko bhi muskaan bana de vaisa.😂😂
            </span>
          </p>
        </div>
        <h2 class="section-title parallax">About</h2>
        <p class="about-text parallax">
          Humne is website ko isliye banaya kyunki hamari dosti khaas hai.<br />
          Yeh yaadein, emotions aur hansi ke lamhon ko hamesha zinda rakhti hai.
        </p>
        <h2 class="section-title parallax">School Life</h2>
        <p class="about-text parallax">
          School ka har din khaas tha <br />
          Hamare number bhale kam aaye hon<br />
          Par dukhi mat ho bhai <br />
          Jo hota hai bhale ke liye hota hai
        </p>
        <div class="contact-section parallax">
          <p>Phone: 9005222683📞</p>
          <p><em>Wait for your call</em></p>
        </div>
        <h2 class="section-title parallax">Signature</h2>
        <input
          type="text"
          id="signatureInput"
          placeholder="Enter name for signature"
        />
        <button onclick="drawSignature()">Draw Signature</button>
        <svg id="signatureSVG" width="100%" height="80"></svg>
      </div>
    </div>

    <div id="imageModal">
      <span class="closeBtn" onclick="closeImageModal()">×</span>
      <span class="prev" onclick="changeImage(-1)">❮</span>
      <img id="modalImage" src="" alt="Full Image" />
      <span class="next" onclick="changeImage(1)">❯</span>
      <div class="caption" id="modalCaption"></div>
    </div>
    
    <audio id="bgMusic" loop> <source src="dosti.mp3" type="audio/mpeg">
      Aapka browser audio element ko support nahi karta.
    </audio>
    <button onclick="toggleMusic()" class="music-btn">Play Music</button>

    <script>
      /* ---------- GLOBAL VARIABLES & INITIALIZATION ---------- */
      let starCanvas, starCtx, stars = [], shootingStars = [];
      let fireflyCanvas, fireflyCtx, fireflies = [];
      let starCanvasMain, starCtxMain, starsMain = [], shootingStarsMain = [];
      let fireflyCanvasMain, fireflyCtxMain, firefliesMain = [];
      const parallaxItems = [];
      const parallaxItemsMain = [];
      let images = [], currentIndex = 0;

      /* ---------- INTRO LOGIC ---------- */
      window.addEventListener('load', () => {
        // Initialize main content animations after intro
        setTimeout(() => {
          const introDiv = document.getElementById('intro');
          if (introDiv) introDiv.style.display = 'none';
          
          const mainContentDiv = document.getElementById('main-content');
          if (mainContentDiv) mainContentDiv.style.display = 'flex';

          initSkyMain();
          initFirefliesMain();
          // initParallaxMain(); // Parallax for main content can be performance heavy, enable if needed
          initHeartTrailMain();
        }, 4000); // Duration of intro animation

        // Initialize image modal functionality
        document.querySelectorAll('.photos img').forEach((img, idx) => {
          images.push(img);
          img.addEventListener('click', () => openImageModal(idx));
        });
      });

      /* ---------- FORM SUBMIT ---------- */
      function handleSubmit() {
        const nameInput = document.getElementById('nameInput');
        const messageBox = document.getElementById('messageBox');
        const videoSection = document.getElementById('videoSection');

        if (nameInput && messageBox && videoSection) {
          const name = nameInput.value.trim();
          if (name !== '') {
            messageBox.innerText = `Hello ${name}!\nI miss you bhai`;
            messageBox.style.display = 'block';
            videoSection.style.display = 'block';
          } else {
            messageBox.innerText = 'Please enter your name.';
            messageBox.style.display = 'block';
            videoSection.style.display = 'none';
          }
        }
      }

      /* ---------- SETTINGS PANEL & PASSWORD ---------- */
      document.getElementById('settingsBtn').addEventListener('click', () => {
        const settingsPanel = document.getElementById('settingsPanel');
        if (settingsPanel) {
            settingsPanel.classList.add('active');
            if (!starCanvas) initSky(); 
            if (!fireflyCanvas) initFireflies();
            if (parallaxItems.length === 0) initParallax(); 
            if (!document.getElementById('settingsPanel').dataset.heartTrailInitialized) {
                 initHeartTrail(); 
                 document.getElementById('settingsPanel').dataset.heartTrailInitialized = 'true';
            }
        }
      });

      function verifyPassword() {
        const pwdInput = document.getElementById('pwdInput');
        const passwordPrompt = document.getElementById('passwordPrompt');
        const settingsContent = document.getElementById('settingsContent');
        const pwdError = document.getElementById('pwdError');

        if (pwdInput && passwordPrompt && settingsContent && pwdError) {
          if (pwdInput.value.trim() === 'friendship') {
            passwordPrompt.style.display = 'none';
            settingsContent.style.display = 'block';
            pwdError.style.display = 'none';
            document.querySelectorAll('.typewriter').forEach((el) => {
              el.style.animation = 'typing 3s steps(40,end) 0.5s forwards, blink-caret .75s step-end infinite';
            });
          } else {
            pwdError.style.display = 'block';
          }
        }
      }

      function closeSettingsPanel() { 
        const settingsPanel = document.getElementById('settingsPanel');
        const pwdInput = document.getElementById('pwdInput');
        const passwordPrompt = document.getElementById('passwordPrompt');
        const settingsContent = document.getElementById('settingsContent');
        const pwdError = document.getElementById('pwdError');

        if (settingsPanel) settingsPanel.classList.remove('active');
        if (pwdInput) pwdInput.value = '';
        if (passwordPrompt) passwordPrompt.style.display = 'block';
        if (settingsContent) settingsContent.style.display = 'none';
        if (pwdError) pwdError.style.display = 'none';
      }

      /* ---------- IMAGE MODAL LOGIC ---------- */
      function openImageModal(idx) {
        currentIndex = idx;
        const modal = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');
        const modalCaption = document.getElementById('modalCaption');

        if (modal && modalImage && modalCaption && images[idx]) {
          modalImage.src = images[idx].src;
          modalImage.alt = images[idx].alt || 'Full Image'; 
          modalCaption.textContent = images[idx].alt || '';
          modal.style.display = 'flex';
        }
      }

      function closeImageModal() {
        const modal = document.getElementById('imageModal');
        if (modal) modal.style.display = 'none';
      }

      function changeImage(step) {
        currentIndex = (currentIndex + step + images.length) % images.length;
        const modalImage = document.getElementById('modalImage');
        const modalCaption = document.getElementById('modalCaption');
        if (modalImage && modalCaption && images[currentIndex]) {
          modalImage.src = images[currentIndex].src;
          modalImage.alt = images[currentIndex].alt || 'Full Image';
          modalCaption.textContent = images[currentIndex].alt || '';
        }
      }

      document.addEventListener('keydown', (e) => {
        const modal = document.getElementById('imageModal');
        if (modal && modal.style.display === 'flex') {
          if (e.key === 'ArrowRight') changeImage(1);
          else if (e.key === 'ArrowLeft') changeImage(-1);
          else if (e.key === 'Escape') closeImageModal();
        }
      });

      /* ---------- CANVAS RESIZING UTILITY ---------- */
      function resizeCanvasToPanel(canvas, parentElement) {
        if (canvas && parentElement) {
          canvas.width = parentElement.clientWidth;
          canvas.height = parentElement.clientHeight;
        }
      }

      window.addEventListener('resize', () => {
        const settingsPanel = document.getElementById('settingsPanel');
        if (starCanvas && settingsPanel) resizeCanvasToPanel(starCanvas, settingsPanel);
        if (fireflyCanvas && settingsPanel) resizeCanvasToPanel(fireflyCanvas, settingsPanel);
        
        if (starCanvasMain) resizeCanvasToPanel(starCanvasMain, document.body);
        if (fireflyCanvasMain) resizeCanvasToPanel(fireflyCanvasMain, document.body);

        if (starCanvas && settingsPanel && settingsPanel.classList.contains('active')) createStars();
        if (fireflyCanvas && settingsPanel && settingsPanel.classList.contains('active')) createFireflies();
        if (starCanvasMain) createStarsMain();
        if (fireflyCanvasMain) createFirefliesMain();
      });
      
      /* ---------- ANIMATED NIGHT SKY (SETTINGS PANEL) ---------- */
      function initSky() {
        const panel = document.getElementById('settingsPanel');
        starCanvas = document.getElementById('starCanvas');
        if (!panel || !starCanvas) return;
        starCtx = starCanvas.getContext('2d');
        resizeCanvasToPanel(starCanvas, panel);
        createStars();
        animateSky(); 
      }

      function createStars() {
        if (!starCanvas) return;
        stars = [];
        const numStars = Math.floor(starCanvas.width * starCanvas.height / 10000); 
        for (let i = 0; i < Math.min(150, numStars) ; i++) { 
          stars.push({
            x: Math.random() * starCanvas.width,
            y: Math.random() * starCanvas.height,
            radius: Math.random() * 1.2 + 0.3, 
            alpha: Math.random() * 0.5 + 0.3, 
            alphaDir: (Math.random() * 0.01 + 0.005) * (Math.random() < 0.5 ? 1 : -1),
          });
        }
      }

      function animateSky() {
        if (!starCtx || !starCanvas) return requestAnimationFrame(animateSky); 
        starCtx.clearRect(0, 0, starCanvas.width, starCanvas.height);
        stars.forEach((s) => {
          s.alpha += s.alphaDir;
          if (s.alpha <= 0.1 || s.alpha >= 0.8) s.alphaDir *= -1; 
          s.alpha = Math.max(0.1, Math.min(0.8, s.alpha)); 

          starCtx.beginPath();
          starCtx.arc(s.x, s.y, s.radius, 0, 2 * Math.PI);
          starCtx.fillStyle = `rgba(255,255,255,${s.alpha})`;
          starCtx.fill();
        });

        if (Math.random() < 0.008) createShootingStar(); 
        shootingStars = shootingStars.filter(ss => ss.life > 0); 

        shootingStars.forEach((ss) => {
          ss.x += ss.vx;
          ss.y += ss.vy;
          ss.life--;
          const opacity = Math.max(0, ss.life / ss.maxLife);
          starCtx.beginPath();
          starCtx.moveTo(ss.x, ss.y);
          starCtx.lineTo(
            ss.x - ss.length * ss.vx * 0.1, 
            ss.y - ss.length * ss.vy * 0.1
          );
          starCtx.strokeStyle = `rgba(255,255,255,${opacity})`;
          starCtx.lineWidth = ss.width;
          starCtx.stroke();
        });
        requestAnimationFrame(animateSky);
      }

      function createShootingStar() {
        if (!starCanvas) return;
        const side = Math.floor(Math.random() * 4);
        let sx, sy, angle;

        switch(side) {
            case 0: 
                sx = Math.random() * starCanvas.width;
                sy = 0;
                angle = Math.PI / 2 * Math.random() + Math.PI / 4; 
                break;
            case 1: 
                sx = starCanvas.width;
                sy = Math.random() * starCanvas.height;
                angle = Math.PI / 2 * Math.random() + (3 * Math.PI / 4); 
                break;
            case 2: 
                sx = Math.random() * starCanvas.width;
                sy = starCanvas.height;
                angle = Math.PI / 2 * Math.random() + (5 * Math.PI / 4); 
                break;
            default: 
                sx = 0;
                sy = Math.random() * starCanvas.height;
                angle = Math.PI / 2 * Math.random() - Math.PI / 4; 
                break;
        }
        
        const speed = Math.random() * 3 + 3; 
        shootingStars.push({
          x: sx, y: sy,
          vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed,
          length: Math.random() * 60 + 40, 
          life: Math.floor(Math.random() * 50 + 50), 
          maxLife: 100,
          width: Math.random() * 1.5 + 0.5,
        });
      }

      /* ---------- FIREFLIES (SETTINGS PANEL) ---------- */
      function initFireflies() {
        const panel = document.getElementById('settingsPanel');
        fireflyCanvas = document.getElementById('fireflyCanvas');
        if (!panel || !fireflyCanvas) return;
        fireflyCtx = fireflyCanvas.getContext('2d');
        resizeCanvasToPanel(fireflyCanvas, panel);
        createFireflies();
        animateFireflies(); 
      }

      function createFireflies() {
        if (!fireflyCanvas) return;
        fireflies = [];
        const numFireflies = Math.floor(fireflyCanvas.width * fireflyCanvas.height / 20000); 
        for (let i = 0; i < Math.min(30, numFireflies); i++) { 
          fireflies.push({
            x: Math.random() * fireflyCanvas.width,
            y: Math.random() * fireflyCanvas.height,
            radius: Math.random() * 2.5 + 1, 
            alpha: Math.random() * 0.4 + 0.3, 
            vx: (Math.random() - 0.5) * 0.4, 
            vy: (Math.random() - 0.5) * 0.4,
            pulseSpeed: Math.random() * 0.05 + 0.02, 
            pulseDir: 1
          });
        }
      }

      function animateFireflies() {
        if (!fireflyCtx || !fireflyCanvas) return requestAnimationFrame(animateFireflies);
        fireflyCtx.clearRect(0, 0, fireflyCanvas.width, fireflyCanvas.height);
        fireflies.forEach((f) => {
          f.x += f.vx;
          f.y += f.vy;

          f.alpha += f.pulseSpeed * f.pulseDir;
          if (f.alpha >= 0.8 || f.alpha <= 0.2) f.pulseDir *= -1;
          f.alpha = Math.max(0.2, Math.min(0.8, f.alpha));


          if (f.x < 0 || f.x > fireflyCanvas.width) f.vx *= -1;
          if (f.y < 0 || f.y > fireflyCanvas.height) f.vy *= -1;

          const gradient = fireflyCtx.createRadialGradient(
            f.x, f.y, 0,
            f.x, f.y, f.radius * 5 
          );
          gradient.addColorStop(0, `rgba(255,255,153,${f.alpha})`); 
          gradient.addColorStop(0.5, `rgba(173,255,47,${f.alpha * 0.5})`); 
          gradient.addColorStop(1, 'rgba(255,255,153,0)');
          
          fireflyCtx.beginPath();
          fireflyCtx.arc(f.x, f.y, f.radius * 5, 0, 2 * Math.PI);
          fireflyCtx.fillStyle = gradient;
          fireflyCtx.fill();
        });
        requestAnimationFrame(animateFireflies);
      }

      /* ---------- PARALLAX SCROLLING (SETTINGS PANEL) ---------- */
      function initParallax() {
        const panel = document.getElementById('settingsPanel');
        if (!panel) return;
        while(parallaxItems.length > 0) parallaxItems.pop(); 

        const elements = panel.querySelectorAll('.parallax');
        elements.forEach((el) => {
          parallaxItems.push({
            el,
            speed: parseFloat(el.dataset.parallaxSpeed) || (Math.random() * 0.25 + 0.05), 
          });
        });
        
        panel.removeEventListener('scroll', handleParallaxScroll);
        panel.addEventListener('scroll', handleParallaxScroll);
      }
      function handleParallaxScroll() {
        const panel = document.getElementById('settingsPanel');
        if (!panel) return;
        const scrollTop = panel.scrollTop;
        parallaxItems.forEach((item) => {
          if (document.body.contains(item.el)) {
            item.el.style.transform = `translateY(${scrollTop * item.speed * -1}px)`;
          }
        });
      }


      /* ---------- HANDWRITTEN SIGNATURE EFFECT (SETTINGS PANEL) ---------- */
      function drawSignature() {
        const signatureInput = document.getElementById('signatureInput');
        const svg = document.getElementById('signatureSVG');
        if (!signatureInput || !svg) return;

        const txt = signatureInput.value.trim();
        if (!txt) return;
        
        svg.innerHTML = ''; 
        const textEl = document.createElementNS('http://www.w3.org/2000/svg','text');
        textEl.setAttribute('x', '50%'); 
        textEl.setAttribute('y', '50'); 
        textEl.setAttribute('dominant-baseline', 'middle'); 
        textEl.setAttribute('text-anchor', 'middle'); 
        textEl.textContent = txt;
        svg.appendChild(textEl);
        
        const oldDisplay = svg.style.display;
        svg.style.display = 'block';
        const pathLength = textEl.getComputedTextLength();
        svg.style.display = oldDisplay;

        textEl.setAttribute('stroke-dasharray', pathLength);
        textEl.setAttribute('stroke-dashoffset', pathLength);
        
        textEl.style.animation = 'none';
        textEl.offsetHeight; 
        textEl.style.animation = 'draw 3s ease forwards';
      }

      /* ---------- FLOATING HEART TRAILS (SETTINGS PANEL) ---------- */
      function initHeartTrail() {
        const panel = document.getElementById('settingsPanel');
        if (!panel) return;

        panel.removeEventListener('mousemove', handleHeartTrailMove); 
        panel.addEventListener('mousemove', handleHeartTrailMove);
      }
      function handleHeartTrailMove(e) {
        const panel = document.getElementById('settingsPanel');
        if (!panel || !panel.classList.contains('active')) return; 

        const heart = document.createElement('span');
        heart.className = 'heart';
        heart.textContent = ['❤️', '💖', '💕', '💓', '💗'][Math.floor(Math.random() * 5)]; 
        
        const rect = panel.getBoundingClientRect();
        const x = e.clientX - rect.left; 
        const y = e.clientY - rect.top;

        heart.style.left = x + 'px';
        heart.style.top = y + 'px';
        
        panel.appendChild(heart);
        setTimeout(() => {
          heart.remove();
        }, 1900); 
      }


      /* ---------- ANIMATED NIGHT SKY (MAIN CONTENT) ---------- */
      function initSkyMain() {
        starCanvasMain = document.getElementById('starCanvasMain');
        if (!starCanvasMain) return;
        starCtxMain = starCanvasMain.getContext('2d');
        resizeCanvasToPanel(starCanvasMain, document.body); 
        createStarsMain();
        animateSkyMain();
      }

      function createStarsMain() {
        if (!starCanvasMain) return;
        starsMain = [];
        const numStars = Math.floor(starCanvasMain.width * starCanvasMain.height / 8000); 
        for (let i = 0; i < Math.min(250, numStars); i++) { 
          starsMain.push({
            x: Math.random() * starCanvasMain.width,
            y: Math.random() * starCanvasMain.height,
            radius: Math.random() * 1.5 + 0.5,
            alpha: Math.random() * 0.6 + 0.2,
            alphaDir: (Math.random() * 0.01 + 0.005) * (Math.random() < 0.5 ? 1 : -1),
          });
        }
      }
      function animateSkyMain() {
        if (!starCtxMain || !starCanvasMain) return requestAnimationFrame(animateSkyMain);
        starCtxMain.clearRect(0, 0, starCanvasMain.width, starCanvasMain.height);
        starsMain.forEach((s) => {
          s.alpha += s.alphaDir;
          if (s.alpha <= 0.1 || s.alpha >= 0.8) s.alphaDir *= -1;
          s.alpha = Math.max(0.1, Math.min(0.8, s.alpha));

          starCtxMain.beginPath();
          starCtxMain.arc(s.x, s.y, s.radius, 0, 2 * Math.PI);
          starCtxMain.fillStyle = `rgba(255,255,255,${s.alpha})`;
          starCtxMain.fill();
        });

        if (Math.random() < 0.01) createShootingStarMain(); 
         shootingStarsMain = shootingStarsMain.filter(ss => ss.life > 0);

        shootingStarsMain.forEach((ss) => {
          ss.x += ss.vx;
          ss.y += ss.vy;
          ss.life--;
          const opacity = Math.max(0, ss.life / ss.maxLife);
          starCtxMain.beginPath();
          starCtxMain.moveTo(ss.x, ss.y);
          starCtxMain.lineTo(
            ss.x - ss.length * ss.vx * 0.1,
            ss.y - ss.length * ss.vy * 0.1
          );
          starCtxMain.strokeStyle = `rgba(255,255,255,${opacity})`;
          starCtxMain.lineWidth = ss.width;
          starCtxMain.stroke();
        });
        requestAnimationFrame(animateSkyMain);
      }
      function createShootingStarMain() {
         if (!starCanvasMain) return;
        const side = Math.floor(Math.random() * 4);
        let sx, sy, angle;

        switch(side) {
            case 0: 
                sx = Math.random() * starCanvasMain.width; sy = 0;
                angle = Math.PI / 2 * Math.random() + Math.PI / 4; 
                break;
            case 1: 
                sx = starCanvasMain.width; sy = Math.random() * starCanvasMain.height;
                angle = Math.PI / 2 * Math.random() + (3 * Math.PI / 4); 
                break;
            case 2: 
                sx = Math.random() * starCanvasMain.width; sy = starCanvasMain.height;
                angle = Math.PI / 2 * Math.random() + (5 * Math.PI / 4); 
                break;
            default: 
                sx = 0; sy = Math.random() * starCanvasMain.height;
                angle = Math.PI / 2 * Math.random() - Math.PI / 4; 
                break;
        }
        const speed = Math.random() * 4 + 4; 
        shootingStarsMain.push({
          x: sx, y: sy,
          vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed,
          length: Math.random() * 70 + 50,
          life: Math.floor(Math.random() * 60 + 60),
          maxLife: 120,
          width: Math.random() * 2 + 0.8,
        });
      }

      /* ---------- FIREFLIES (MAIN CONTENT) ---------- */
      function initFirefliesMain() {
        fireflyCanvasMain = document.getElementById('fireflyCanvasMain');
        if (!fireflyCanvasMain) return;
        fireflyCtxMain = fireflyCanvasMain.getContext('2d');
        resizeCanvasToPanel(fireflyCanvasMain, document.body);
        createFirefliesMain();
        animateFirefliesMain();
      }
      function createFirefliesMain() {
        if (!fireflyCanvasMain) return;
        firefliesMain = [];
        const numFireflies = Math.floor(fireflyCanvasMain.width * fireflyCanvasMain.height / 15000);
        for (let i = 0; i < Math.min(50, numFireflies); i++) { 
          firefliesMain.push({
            x: Math.random() * fireflyCanvasMain.width,
            y: Math.random() * fireflyCanvasMain.height,
            radius: Math.random() * 3 + 1.5,
            alpha: Math.random() * 0.5 + 0.3,
            vx: (Math.random() - 0.5) * 0.5,
            vy: (Math.random() - 0.5) * 0.5,
            pulseSpeed: Math.random() * 0.04 + 0.01,
            pulseDir: 1
          });
        }
      }
      function animateFirefliesMain() {
        if (!fireflyCtxMain || !fireflyCanvasMain) return requestAnimationFrame(animateFirefliesMain);
        fireflyCtxMain.clearRect(0, 0, fireflyCanvasMain.width, fireflyCanvasMain.height);
        firefliesMain.forEach((f) => {
          f.x += f.vx;
          f.y += f.vy;
          f.alpha += f.pulseSpeed * f.pulseDir;
          if (f.alpha >= 0.9 || f.alpha <= 0.3) f.pulseDir *= -1;
          f.alpha = Math.max(0.3, Math.min(0.9, f.alpha));

          if (f.x < -f.radius*5 || f.x > fireflyCanvasMain.width + f.radius*5) f.vx *= -1; 
          if (f.y < -f.radius*5 || f.y > fireflyCanvasMain.height + f.radius*5) f.vy *= -1;

          const gradient = fireflyCtxMain.createRadialGradient(
            f.x, f.y, 0,
            f.x, f.y, f.radius * 6
          );
          gradient.addColorStop(0, `rgba(255,255,100,${f.alpha})`); 
          gradient.addColorStop(0.6, `rgba(255,215,0,${f.alpha * 0.4})`); 
          gradient.addColorStop(1, 'rgba(255,255,100,0)');
          
          fireflyCtxMain.beginPath();
          fireflyCtxMain.arc(f.x, f.y, f.radius * 6, 0, 2 * Math.PI);
          fireflyCtxMain.fillStyle = gradient;
          fireflyCtxMain.fill();
        });
        requestAnimationFrame(animateFirefliesMain);
      }

      /* ---------- PARALLAX SCROLLING (MAIN CONTENT - OPTIONAL) ---------- */
      function initParallaxMain() {
        while(parallaxItemsMain.length > 0) parallaxItemsMain.pop();

        const elements = document.querySelectorAll('#main-content .parallax, .shayari-generator.parallax'); 
        elements.forEach((el) => {
          parallaxItemsMain.push({
            el,
            speed: parseFloat(el.dataset.parallaxSpeed) || (Math.random() * 0.2 + 0.05), 
          });
        });
        window.removeEventListener('scroll', handleParallaxScrollMain);
        window.addEventListener('scroll', handleParallaxScrollMain);
      }
       function handleParallaxScrollMain() {
        const scrollTop = window.scrollY;
        parallaxItemsMain.forEach((item) => {
          if (document.body.contains(item.el)) {
            item.el.style.transform = `translateY(${scrollTop * item.speed * -1}px)`;
          }
        });
      }


      /* ---------- FLOATING HEART TRAILS (MAIN BODY) ---------- */
      function initHeartTrailMain() {
        document.body.removeEventListener('mousemove', handleHeartTrailMainMove);
        document.body.addEventListener('mousemove', handleHeartTrailMainMove);
      }
      function handleHeartTrailMainMove(e) {
        const settingsPanel = document.getElementById('settingsPanel');
        if (settingsPanel && settingsPanel.classList.contains('active')) {
            const rect = settingsPanel.getBoundingClientRect();
            if (e.clientX >= rect.left && e.clientX <= rect.right &&
                e.clientY >= rect.top && e.clientY <= rect.bottom) {
                return; 
            }
        }

        const heart = document.createElement('span');
        heart.className = 'heart';
        heart.textContent = ['❤️', '💖', '💕', '💓', '💗', '💙', '💚', '💛', '💜'][Math.floor(Math.random() * 9)]; 
        heart.style.left = e.clientX + 'px';
        heart.style.top = e.clientY + 'px';
        heart.style.fontSize = (Math.random() * 10 + 12) + 'px'; 
        document.body.appendChild(heart);
        setTimeout(() => {
          heart.remove();
        }, 1900);
      }

      /* ---------- MUSIC PLAYER ---------- */
      function toggleMusic() {
        const music = document.getElementById("bgMusic");
        const btn = document.querySelector(".music-btn");
        if (!music || !btn) return;

        if (music.paused) {
          music.play().catch(error => console.error("Music play failed:", error)); 
          btn.innerText = "Pause Music";
        } else {
          music.pause();
          btn.innerText = "Play Music";
        }
      }
      document.body.addEventListener('click', () => {
        const music = document.getElementById("bgMusic");
        if (music && music.paused && music.currentTime === 0) { 
            // music.play().catch(e => console.log("Autoplay blocked, user interaction needed."));
        }
      }, { once: true });


      /* ---------- AI SHAYARI GENERATOR FUNCTIONALITY ---------- */
      async function generateShayari() {
        const keywordInput = document.getElementById('shayariKeywordInput');
        const shayariDisplay = document.getElementById('generatedShayari');
        const loadingIndicator = document.getElementById('shayariLoading');

        if (!keywordInput || !shayariDisplay || !loadingIndicator) {
            console.error("Shayari generator elements not found.");
            return;
        }

        const keyword = keywordInput.value.trim();
        if (keyword === "") {
            shayariDisplay.innerText = "Pehle koi naam ya shabd daalein.";
            return;
        }

        loadingIndicator.style.display = 'block';
        shayariDisplay.innerText = ""; 

        const prompt = `दोस्ती पर एक छोटी, दिल को छू लेने वाली 2-पंक्ति की शायरी हिंदी में लिखें, जो इस शब्द/नाम से प्रेरित हो: "${keyword}". शायरी भावनात्मक होनी चाहिए और दोस्ती का जश्न मनाने वाली होनी चाहिए। इसे सरल और दिल को छू लेने वाला रखें। केवल शायरी दें, कोई अतिरिक्त टेक्स्ट नहीं।`;
        
        let chatHistory = [];
        chatHistory.push({ role: "user", parts: [{ text: prompt }] });
        const payload = { contents: chatHistory };
        // IMPORTANT: API Key has been added here as per your request
        const apiKey = "AIzaSyD8gfAlGecRG5Izec26W1RegdvlJN_70TM"; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                console.error("API Error:", errorData);
                throw new Error(`API request failed with status ${response.status}: ${errorData.error?.message || 'Unknown error'}`);
            }

            const result = await response.json();
            
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const generatedText = result.candidates[0].content.parts[0].text;
                shayariDisplay.innerText = generatedText.trim();
            } else {
                console.error("Unexpected API response structure:", result);
                shayariDisplay.innerText = "Maaf kijiye, abhi shayari generate nahi ho saki. AI se sahi jawab nahi mila.";
            }

        } catch (error) {
            console.error('Error generating shayari:', error);
            shayariDisplay.innerText = `Maaf kijiye, shayari generate karte waqt error aa gaya. Kripya baad mein try karein. (Details: ${error.message})`;
        } finally {
            loadingIndicator.style.display = 'none';
        }
      }

    </script>
  </body>
</html>


